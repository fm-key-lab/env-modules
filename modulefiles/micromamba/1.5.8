#%Module
##
## micromamba (v1.5.8)

proc ModulesHelp { } {
   puts stderr "
Adds micromamba to your path.
Version 1.5.8
"
}

module-whatis "Adds micromamba to your path\n"
module-whatis "Provides: micromamba"

conflict anaconda
conflict python

set basedir [getenv "MODULE_BASEDIR"]
if { $basedir eq "" } {
    puts stderr "Error: MODULE_BASEDIR environment variable is not set."
    exit 1
}

prepend-path PATH "${basedir}/apps/micromamba"

# Set MAMBA_ROOT_PREFIX to default value if not already set
if {![info exists env(MAMBA_ROOT_PREFIX)]} {
    setenv MAMBA_ROOT_PREFIX "$env(HOME)/micromamba"
}

# cat /mpcdf/soft/SLE_15/packages/x86_64/anaconda/3/2023.03/.condarc
set key_conf "$env(GROUP_HOME)/etc/.condarc"
setenv MAMBARC $key_conf

# TODO: Consider hook parsing as implemented in 
#       /mpcdf/soft/SLE_15/modules/python/anaconda/3/2023.03
#       /mpcdf/soft/SLE_15/packages/x86_64/Modules/5.4.0/etc/module_hooks.tcl

# Evaluate shell hook
catch { exec bash -c "eval \"\$(${basedir}/apps/micromamba/1.5.8 shell hook -s bash)\"" }
# Enable shell completion
catch { exec bash -c "eval \"\$(${basedir}/apps/micromamba/1.5.8 shell completion)\"" }

# Cleanup when module is unloaded
if {[module-info mode remove]} {
    unsetenv MAMBA_ROOT_PREFIX
    catch { exec bash -c "eval \"\$(${basedir}/apps/micromamba/1.5.8 shell dehook -s bash)\"" }
}